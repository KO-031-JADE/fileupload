<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Upload</title>

    <script src="https://unpkg.com/dropzone@5/dist/min/dropzone.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/dropzone@5/dist/min/dropzone.min.css" type="text/css" />
    <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/css/bootstrap.min.css' />
</head>

<body class="m-4">
    <div class="dropzone"></div>

    <!-- 포스팅 - 이미지 dropzone 영역 -->
    <ul class="list-unstyled mb-0" id="dropzone-preview">
        <li class="mt-2" id="dropzone-preview-list">
            <!-- This is used as the file preview template -->
            <div class="border rounded-3">
                <div class="d-flex align-items-center p-2">
                    <div class="flex-shrink-0 me-3">
                        <div class="width-8 h-auto rounded-3">
                            <img data-dz-thumbnail class="w-full h-auto rounded-3 block" src="#" alt="Dropzone-Image" style="width: 120px;" />
                        </div>
                    </div>
                    <div class="flex-grow-1">
                        <div class="pt-1">
                            <h6 class="font-semibold mb-1" data-dz-name>&nbsp;</h6>
                            <p class="text-sm text-muted fw-normal" data-dz-size></p>
                            <strong class="error text-danger" data-dz-errormessage></strong>
                        </div>
                    </div>
                    <div class="shrink-0 ms-3">
                        <button data-dz-remove class="btn btn-sm btn-danger">Delete</button>
                    </div>
                </div>
            </div>
        </li>
    </ul>

    <script>
        Dropzone.autoDiscover = false;
        var dropzonePreviewNode = document.querySelector('#dropzone-preview-list');
        dropzonePreviewNode.id = '';
        var previewTemplate = dropzonePreviewNode.parentNode.innerHTML;
        dropzonePreviewNode.parentNode.removeChild(dropzonePreviewNode);

        const dropzone = new Dropzone(".dropzone", {
            url: "https://httpbin.org/post",
            method: "post",
            previewTemplate: previewTemplate,
            previewsContainer: '#dropzone-preview',
            acceptedFiles: "image/jpeg,image/png,image/gif,image/jpg",
            maxFiles: 3, // 최대 파일 개수 제한
            init: function () {
                this.on("addedfile", function (file) {
                    const fileName = file.name;
                    const fileExtension = fileName.substring(fileName.lastIndexOf('.') + 1).toLowerCase();
                    console.log("File Extension: " + fileExtension);

                    if (!['jpg', 'jpeg', 'png', 'gif'].includes(fileExtension)) {
                        console.log("이미지 파일 확인부탁드립니다.");
                        this.removeFile(file);
                    }
                });

                this.on("maxfilesexceeded", function (file) {
                    alert("최대 3개 이미지 업로드가 가능합니다.");
                    this.removeFile(file); // 초과된 파일 삭제
                });
            }
        });

        // Sortable 적용
        const sortable = new Sortable(document.getElementById('dropzone-preview'), {
            animation: 150,
            ghostClass: 'sortable-ghost',
            handle: '.d-flex', // Drag area for the images
            onEnd: function (/**Event*/evt) {
                console.log("New order:", evt.newIndex);
            }
        });
    </script>
</body>

</html>
